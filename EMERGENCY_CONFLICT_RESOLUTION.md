# 🚨 緊急：ID衝突回避ワークフロー

## 🎯 目的
アプリID重複による既存アプリの上書き・消失を防ぐための緊急対応手順

## ⚠️ 想定される問題
- **アプリIDが重複**: 001, 002などが既に使用済み
- **上書きリスク**: 既存アプリが消失する危険性
- **全く別のアプリ**: 同じIDで異なるアプリが登録される

## 🛡️ 必須チェック手順

### 1. デプロイ前の存在確認（必須）

#### A. GitHub Pages確認
```bash
# デプロイ先URL例
https://muumuu8181.github.io/ai-auto-generator/

# アプリ一覧を確認
# 001/index.html が存在するか？
# 002/index.html が存在するか？
# 003/index.html が存在するか？
```

#### B. リポジトリ確認
```bash
# フォルダ構造チェック
ls -la /path/to/repo/
# 001/ フォルダが存在するか？
# 002/ フォルダが存在するか？
```

#### C. 既存アプリ内容確認
```bash
# 既存アプリのタイトルを確認
cat 001/index.html | grep "<title>"
# 内容が今回作成するものと同じか？
```

### 2. 衝突時の緊急対応

#### Pattern A: 完全な重複（同じアプリ）
```
既存: 001/電卓アプリ
新規: 001/電卓アプリ

→ 対応: 既存アプリを改良・上書きする
→ コミット: "Improve calculator app (001)"
```

#### Pattern B: 異なるアプリ（危険）
```
既存: 001/電卓アプリ
新規: 001/時間管理アプリ

→ 対応: 新規アプリの番号を変更
→ 新規: 002/時間管理アプリ
→ ID管理システムも更新
```

#### Pattern C: 類似アプリ（判断が微妙）
```
既存: 001/シンプル電卓
新規: 001/高機能電卓

→ 対応: バージョン番号付与
→ 新規: 001-v2/高機能電卓
→ または: 004/高機能電卓（新ID）
```

### 3. 具体的対応手順

#### Step 1: 即座停止
```
⚠️ ID衝突を検知したら即座に作業停止
⚠️ アップロード・プッシュを行わない
⚠️ 状況を正確に把握する
```

#### Step 2: 既存アプリ確認
```bash
# 1. 既存アプリの内容確認
curl https://muumuu8181.github.io/ai-auto-generator/001/index.html

# 2. アプリタイプ判定
# - 電卓系？時間管理系？お金管理系？
# - 機能は同じ？違う？

# 3. 最終更新日確認
git log --oneline | grep "001"
```

#### Step 3: 緊急回避策実行

##### Case A: 同種アプリ（安全な上書き）
```bash
# 既存の改良版として扱う
# フォルダ名: 001/ (そのまま)
# コミットメッセージ: "Improve [アプリ名] with [新機能]"
```

##### Case B: 異種アプリ（危険な衝突）
```bash
# 1. 新しいIDを割り当て
mv 001/ 004/  # 利用可能な次のIDに変更

# 2. ファイル内のパス修正
sed -i 's/001/004/g' 004/index.html
sed -i 's/001/004/g' 004/*.js

# 3. ID管理システム更新
# app-type-registry.json の next_available_id を "005" に更新

# 4. アプリ名に識別子追加
# タイトル: "時間管理アプリ" → "時間管理アプリ v2"
```

##### Case C: 名前重複回避
```bash
# アプリ名に番号追加
# "電卓" → "電卓2"
# "Timer" → "Timer Pro"  
# "家計簿" → "家計簿 Plus"
```

### 4. フォールバック命名規則

#### アプリ名サフィックス
```
基本: [アプリ名]
重複1: [アプリ名] v2
重複2: [アプリ名] Pro  
重複3: [アプリ名] Plus
重複4: [アプリ名] Advanced
重複5: [アプリ名] [日付] (例: 電卓 0125)
```

#### フォルダ名サフィックス
```
基本: 001/
重複1: 001-v2/
重複2: 001-pro/
重複3: [次のID]/ (例: 004/)
```

### 5. 緊急時コミュニケーション

#### エラーメッセージ例
```
🚨 ID衝突検知: 001番が既に使用されています

既存アプリ: 電卓アプリ (最終更新: 2025-01-20)
作成予定: 時間管理アプリ

緊急対応: 新アプリを004番に変更します
新フォルダ: 004/
新タイトル: 時間管理アプリ v2

この対応で進めてもよろしいですか？
```

#### 成功時の報告
```
✅ ID衝突回避完了

対応内容:
- 既存: 001/電卓アプリ (保護済み)  
- 新規: 004/時間管理アプリ v2 (新規作成)
- ID管理: next_available_id を 005 に更新

デプロイURL: https://muumuu8181.github.io/ai-auto-generator/004/
```

### 6. 予防策（今後の改善）

#### 短期対策
- [ ] デプロイ前チェックの自動化
- [ ] ID重複検知スクリプト
- [ ] 既存アプリ一覧表示機能

#### 長期対策  
- [ ] AI間の情報共有システム
- [ ] リアルタイムID同期
- [ ] 衝突予測アルゴリズム

## 🚀 実行チェックリスト

### デプロイ前（必須）
- [ ] GitHub Pagesで既存アプリ確認
- [ ] リポジトリフォルダ構造確認  
- [ ] 同じIDのアプリが存在しないか確認
- [ ] 既存アプリの内容・機能を把握

### 衝突検知時（緊急）
- [ ] 作業即座停止
- [ ] 既存アプリの詳細確認
- [ ] 同種/異種アプリの判定
- [ ] 適切な回避策選択
- [ ] ID管理システム更新

### 対応完了後（確認）
- [ ] 新しいIDでの正常動作確認
- [ ] 既存アプリが影響を受けていないか確認
- [ ] コミットメッセージに経緯記載
- [ ] 次回への学習データ蓄積

---

## 📢 重要メッセージ

**「システムの穴があっても、そこでやられるのは悲しい」**

現在は移行期間です。ID管理システムの完璧な動作まで、この緊急対応手順で**既存アプリを絶対に守る**ことを最優先とします。

**判断に迷ったら新しいIDを使う** - これが鉄則です。